---
phase: 02-interactive-content
plan: 04
type: execute
wave: 2
depends_on: ["02-01", "02-02"]
files_modified:
  - frontend/src/types/course.ts
  - frontend/src/components/learning/course-player/VideoLesson.tsx
  - frontend/src/components/learning/course-player/LessonViewer.tsx
  - frontend/src/data/courses/sel-essentials.json
autonomous: false

must_haves:
  truths:
    - "Video lessons display with interactive player"
    - "Chapter navigation works within video lessons"
    - "Bookmarks can be added to video lessons"
    - "Video progress is tracked per lesson"
  artifacts:
    - path: "frontend/src/components/learning/course-player/VideoLesson.tsx"
      provides: "Video lesson container using InteractiveVideoPlayer"
      min_lines: 60
    - path: "frontend/src/types/course.ts"
      provides: "Updated ContentBlock to support video type"
      contains: "type.*video"
  key_links:
    - from: "VideoLesson.tsx"
      to: "InteractiveVideoPlayer"
      via: "component usage"
      pattern: "InteractiveVideoPlayer"
    - from: "LessonViewer.tsx"
      to: "VideoLesson.tsx"
      via: "video content rendering"
      pattern: "VideoLesson|case.*video"
---

<objective>
Integrate interactive video player into course learning system.

Purpose: Connect the new video player to existing course infrastructure so video lessons become interactive.
Output: VideoLesson component integrated into LessonViewer, with sample video content for testing.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior work
@.planning/phases/02-interactive-content/02-01-SUMMARY.md
@.planning/phases/02-interactive-content/02-02-SUMMARY.md

# Existing course player infrastructure
@frontend/src/components/learning/course-player/LessonViewer.tsx
@frontend/src/types/course.ts
@frontend/src/data/courses/sel-essentials.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend ContentBlock type to support video</name>
  <files>frontend/src/types/course.ts</files>
  <action>
    Update `frontend/src/types/course.ts`:

    1. Extend ContentBlock type union to include 'video':
       ```typescript
       export interface ContentBlock {
         type: 'text' | 'heading' | 'list' | 'image' | 'quote' | 'highlight' | 'video';
         content?: string;
         items?: string[];
         src?: string;
         alt?: string;
         caption?: string;
         // Video-specific fields
         videoUrl?: string;
         chapters?: Array<{
           id: string;
           title: string;
           startTime: number;
           endTime?: number;
         }>;
         quizTriggers?: Array<{
           id: string;
           timestamp: number;
           quizId: string;
           required: boolean;
         }>;
       }
       ```

    2. Ensure backwards compatibility - existing text/image blocks still work.

    3. Add VideoContentBlock as a separate interface if cleaner, then union with ContentBlock.
  </action>
  <verify>npm run build succeeds, existing course data still parses</verify>
  <done>ContentBlock supports video type with chapters and quiz triggers</done>
</task>

<task type="auto">
  <name>Task 2: Create VideoLesson component</name>
  <files>frontend/src/components/learning/course-player/VideoLesson.tsx</files>
  <action>
    Create `frontend/src/components/learning/course-player/VideoLesson.tsx`:

    Props:
    - content: ContentBlock (video type)
    - lessonId: string
    - onComplete?: () => void

    Features:
    - Render InteractiveVideoPlayer with content data
    - Map content.chapters to player chapters prop
    - Map content.quizTriggers if present
    - Generate videoId from lessonId for progress tracking
    - Show VideoBookmarks in sidebar or below player
    - Handle video completion â†’ call onComplete

    Layout:
    - Desktop: Player (main) + Chapters + Bookmarks sidebar
    - Mobile: Stacked layout

    Integration:
    - Import InteractiveVideoPlayer, VideoBookmarks from components/video
    - Use eventBus to emit 'lesson:completed' when video finishes
  </action>
  <verify>TypeScript compiles, VideoLesson renders with test data</verify>
  <done>VideoLesson wraps InteractiveVideoPlayer with course context</done>
</task>

<task type="auto">
  <name>Task 3: Integrate VideoLesson into LessonViewer</name>
  <files>frontend/src/components/learning/course-player/LessonViewer.tsx</files>
  <action>
    Update `LessonViewer.tsx` to handle video content:

    1. Import VideoLesson component

    2. In renderContent function, add case for 'video' type:
       ```typescript
       case 'video':
         return (
           <VideoLesson
             key={index}
             content={block}
             lessonId={lesson.id}
             onComplete={onComplete}
           />
         );
       ```

    3. Ensure video content renders correctly alongside other content types.

    4. Test that existing text/image content still renders.
  </action>
  <verify>npm run build succeeds, video and text content render correctly</verify>
  <done>LessonViewer renders video content using VideoLesson component</done>
</task>

<task type="auto">
  <name>Task 4: Add sample video content to course data</name>
  <files>frontend/src/data/courses/sel-essentials.json</files>
  <action>
    Update `sel-essentials.json` to add video content for testing:

    Add a video content block to one lesson (e.g., first lesson of first module):

    ```json
    {
      "type": "video",
      "videoUrl": "https://www.youtube.com/watch?v=dQw4w9WgXcQ",
      "chapters": [
        { "id": "ch1", "title": "Introduction", "startTime": 0 },
        { "id": "ch2", "title": "Main Concepts", "startTime": 30 },
        { "id": "ch3", "title": "Summary", "startTime": 120 }
      ]
    }
    ```

    Use a real YouTube video that's educational (or a free sample video).
    BigBuckBunny is a good test video: https://www.youtube.com/watch?v=aqz-KE-bpKQ

    Keep it simple - just chapters, no quiz triggers for initial testing.
  </action>
  <verify>JSON is valid, course data loads without errors</verify>
  <done>Sample video content added to course for testing</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Interactive video player integrated into course learning system with chapters, bookmarks, and progress tracking</what-built>
  <how-to-verify>
    1. Run: cd frontend && npm run dev
    2. Login as a student
    3. Navigate to Courses and select "SEL Essentials" (or course with video)
    4. Find a lesson with video content
    5. Verify:
       - Video player displays with custom controls
       - Chapters list shows and clicking jumps to chapter
       - Add a bookmark - verify it appears in bookmarks list
       - Click bookmark to jump to that position
       - Play video, pause, refresh page
       - Video should resume from last position
       - Complete video and check XP/progress updates
  </how-to-verify>
  <resume-signal>Type "approved" if video integration works, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds
- [ ] No TypeScript errors
- [ ] ContentBlock supports video type
- [ ] VideoLesson component renders video
- [ ] LessonViewer handles video content blocks
- [ ] Sample video content added to course data
- [ ] Human verification of visual/functional behavior passed
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Human verification approved
- Video lessons work within existing course infrastructure
- Chapters, bookmarks, and progress all functional
</success_criteria>

<output>
After completion, create `.planning/phases/02-interactive-content/02-04-SUMMARY.md`
</output>
