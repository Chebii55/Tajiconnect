---
phase: 02-interactive-content
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/types/video.ts
  - frontend/src/stores/videoStore.ts
  - frontend/src/components/video/InteractiveVideoPlayer.tsx
  - frontend/src/components/video/VideoChapters.tsx
  - frontend/src/components/video/VideoControls.tsx
  - frontend/package.json
autonomous: true

must_haves:
  truths:
    - "User can play/pause video with custom controls"
    - "User can see chapter list and navigate to chapters"
    - "Video remembers playback position"
  artifacts:
    - path: "frontend/src/types/video.ts"
      provides: "Video, Chapter, Bookmark, VideoQuiz types"
      contains: "interface Chapter"
    - path: "frontend/src/stores/videoStore.ts"
      provides: "Video progress persistence"
      contains: "create("
    - path: "frontend/src/components/video/InteractiveVideoPlayer.tsx"
      provides: "Main video player wrapper"
      min_lines: 80
    - path: "frontend/src/components/video/VideoChapters.tsx"
      provides: "Chapter navigation sidebar"
      min_lines: 40
  key_links:
    - from: "InteractiveVideoPlayer.tsx"
      to: "react-player"
      via: "ReactPlayer component"
      pattern: "import.*ReactPlayer"
    - from: "InteractiveVideoPlayer.tsx"
      to: "videoStore"
      via: "useVideoStore hook"
      pattern: "useVideoStore"
    - from: "VideoChapters.tsx"
      to: "InteractiveVideoPlayer.tsx"
      via: "onChapterClick callback"
      pattern: "onChapterClick|seekTo"
---

<objective>
Build interactive video player with chapters and progress tracking.

Purpose: Transform passive video watching into navigable, resumable learning experiences.
Output: InteractiveVideoPlayer component with chapters, custom controls, and Zustand-based progress persistence.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Codebase patterns to follow
@.planning/codebase/CONVENTIONS.md
@.planning/codebase/STRUCTURE.md

# Existing components for reference
@frontend/src/components/learning/course-player/LessonViewer.tsx
@frontend/src/types/course.ts
@frontend/src/stores/gamificationStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install react-player and create video types</name>
  <files>frontend/package.json, frontend/src/types/video.ts</files>
  <action>
    1. Install react-player:
       ```bash
       cd frontend && npm install react-player
       ```

    2. Create `frontend/src/types/video.ts` with:
       - `VideoChapter`: id, title, startTime (seconds), endTime, thumbnail?
       - `VideoBookmark`: id, timestamp, label, createdAt
       - `VideoQuizTrigger`: id, timestamp, quizId, required (must answer to continue)
       - `VideoProgress`: videoId, currentTime, duration, completed, lastWatched, watchedRanges[]
       - `InteractiveVideo`: id, url, title, chapters[], bookmarks[], quizTriggers[], duration

    Follow existing type patterns from course.ts (PascalCase interfaces, proper exports).
  </action>
  <verify>npm run build in frontend succeeds, types export correctly</verify>
  <done>react-player installed, video types defined and exported</done>
</task>

<task type="auto">
  <name>Task 2: Create video progress Zustand store</name>
  <files>frontend/src/stores/videoStore.ts</files>
  <action>
    Create `frontend/src/stores/videoStore.ts` following gamificationStore.ts pattern:

    State:
    - currentVideo: { videoId, currentTime, isPlaying, volume, playbackRate }
    - progressMap: Record<videoId, VideoProgress>
    - bookmarks: Record<videoId, VideoBookmark[]>

    Actions:
    - setCurrentVideo(videoId: string)
    - updateProgress(videoId: string, time: number, duration: number)
    - markCompleted(videoId: string)
    - addBookmark(videoId: string, timestamp: number, label: string)
    - removeBookmark(videoId: string, bookmarkId: string)
    - getProgress(videoId: string): VideoProgress | null
    - getResumeTime(videoId: string): number

    Use persist middleware to localStorage (key: 'video-progress').
    Import types from video.ts.
    Emit events via eventBus: 'video:progress', 'video:completed'.
  </action>
  <verify>TypeScript compiles, store actions work in isolation</verify>
  <done>Video store persists progress to localStorage, emits events for gamification</done>
</task>

<task type="auto">
  <name>Task 3: Create InteractiveVideoPlayer and VideoChapters components</name>
  <files>frontend/src/components/video/InteractiveVideoPlayer.tsx, frontend/src/components/video/VideoChapters.tsx, frontend/src/components/video/VideoControls.tsx, frontend/src/components/video/index.ts</files>
  <action>
    Create `frontend/src/components/video/` directory with:

    **InteractiveVideoPlayer.tsx:**
    - Props: videoUrl, title, chapters[], onComplete?, className?
    - Use ReactPlayer with ref for programmatic control
    - Track progress via onProgress callback → videoStore.updateProgress()
    - Resume from last position on mount using getResumeTime()
    - Handle onEnded → markCompleted(), emit 'video:completed' event
    - Layout: video (70%) + chapters sidebar (30%) on desktop, stacked on mobile
    - Show current chapter highlight in chapters list
    - Custom controls (next task provides VideoControls)

    **VideoChapters.tsx:**
    - Props: chapters[], currentTime, onChapterClick(startTime)
    - Display chapter list with timestamps formatted as mm:ss
    - Highlight current chapter based on currentTime
    - Click handler calls onChapterClick which triggers seekTo in player
    - Style with Tailwind, support dark mode

    **VideoControls.tsx:**
    - Props: playing, currentTime, duration, volume, playbackRate, onPlay, onPause, onSeek, onVolumeChange, onRateChange
    - Custom progress bar with clickable seek
    - Play/pause button
    - Volume control with mute toggle
    - Playback speed selector (0.5x, 1x, 1.25x, 1.5x, 2x)
    - Time display: current / duration
    - Fullscreen toggle
    - Use lucide-react icons (Play, Pause, Volume2, VolumeX, Maximize, etc.)

    **index.ts:**
    - Export all components

    Follow component patterns from LessonViewer.tsx (props interfaces, Tailwind styling, dark mode support).
  </action>
  <verify>npm run build succeeds, no TypeScript errors</verify>
  <done>Video player with chapters displays, progress tracking works, chapter navigation functional</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds in frontend
- [ ] No TypeScript errors
- [ ] react-player is in package.json dependencies
- [ ] Video types are exported from types/video.ts
- [ ] videoStore persists to localStorage
- [ ] InteractiveVideoPlayer renders a video
- [ ] Chapters display and are clickable
- [ ] Progress saves on video timeupdate
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- Video player can play video with custom controls
- Chapters are navigable via click
- Progress persists across page refreshes
</success_criteria>

<output>
After completion, create `.planning/phases/02-interactive-content/02-01-SUMMARY.md`
</output>
